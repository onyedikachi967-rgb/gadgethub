<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GadgetHub - Your Premium Electronics Store</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://js.paystack.co/v1/inline.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #0066FF 0%, #00D4FF 100%); }
        .product-card { transition: transform 0.3s ease, box-shadow 0.3s ease; }
        .product-card:hover { transform: translateY(-8px); box-shadow: 0 20px 40px rgba(0,102,255,0.2); }
        .btn-primary { background: linear-gradient(135deg, #0066FF 0%, #00D4FF 100%); transition: all 0.3s ease; }
        .btn-primary:hover { transform: scale(1.05); box-shadow: 0 10px 30px rgba(0,102,255,0.3); }
        .category-chip { transition: all 0.3s ease; }
        .category-chip:hover { background: #0066FF; color: white; transform: scale(1.05); }
        .flash-deal { animation: pulse 2s infinite; }
        @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.8} }
        .badge { position:absolute; top:10px; right:10px; background:#FF4757; color:white; padding:4px 12px; border-radius:20px; font-size:12px; font-weight:bold; }
        .cart-badge { position:absolute; top:-8px; right:-8px; background:#FF4757; color:white; border-radius:50%; width:20px; height:20px; display:flex; align-items:center; justify-content:center; font-size:11px; font-weight:bold; }
        .spinner { border:3px solid #f3f3f3; border-top:3px solid #0066FF; border-radius:50%; width:40px; height:40px; animation:spin 1s linear infinite; }
        @keyframes spin { 0%{transform:rotate(0deg)} 100%{transform:rotate(360deg)} }
        .image-gallery-main { width:100%; height:400px; object-fit:cover; cursor:pointer; border-radius:12px; }
        .thumbnail { width:80px; height:80px; object-fit:cover; cursor:pointer; border-radius:8px; border:2px solid transparent; transition:all 0.3s; }
        .thumbnail:hover { border-color:#0066FF; transform:scale(1.05); }
        .thumbnail.active { border-color:#0066FF; }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect } = React;

        // ============================================================
        // PASTE YOUR GOOGLE SHEETS URL HERE
        // ============================================================
        const GOOGLE_SHEET_URL = "https://docs.google.com/spreadsheets/d/1cqTPgY-VI1Q5dVXC35FJeQAIkyJDE785n8H2jHiUMVA/gviz/tq?tqx=out:json";
        // ============================================================

        const PAYSTACK_PUBLIC_KEY = "pk_live_a9f1df123dad5b0b5a4c3ce36794849125f7b3d3";
        const NOWPAYMENTS_API_KEY = "0YY4S9Q-P0NM2M2-H1AWS97-1NSX3XZ";
        const NGN_TO_USD = 1550;

        const CATEGORIES = [
            { name: "All", icon: "fa-th" },
            { name: "Smartphones", icon: "fa-mobile-alt" },
            { name: "Laptops", icon: "fa-laptop" },
            { name: "Smart Home", icon: "fa-home" },
            { name: "Gaming", icon: "fa-gamepad" },
            { name: "Cameras", icon: "fa-camera" },
            { name: "Audio", icon: "fa-headphones" },
            { name: "Solar", icon: "fa-solar-panel" },
            { name: "Accessories", icon: "fa-plug" },
            { name: "Wearables", icon: "fa-watch" },
            { name: "Monitors & TVs", icon: "fa-tv" }
        ];

        const SAMPLE_PRODUCTS = [
            { id: 1, name: "iPhone 15 Pro Max", category: "Smartphones", price: 1199, images: ["https://images.unsplash.com/photo-1695048133142-1a20484d2569?w=400"], rating: 4.8, sold: 234, discount: 15, inStock: true, description: "Latest iPhone" },
            { id: 2, name: "MacBook Pro 16\"", category: "Laptops", price: 2499, images: ["https://images.unsplash.com/photo-1517336714731-489689fd1ca8?w=400"], rating: 4.9, sold: 156, discount: 10, inStock: true, description: "Powerful laptop" },
        ];

        function GadgetHub() {
            const [products, setProducts] = useState([]);
            const [loading, setLoading] = useState(true);
            const [cart, setCart] = useState([]);
            const [selectedCategory, setSelectedCategory] = useState("All");
            const [view, setView] = useState("home");
            const [selectedProduct, setSelectedProduct] = useState(null);
            const [searchQuery, setSearchQuery] = useState("");
            const [usingSheets, setUsingSheets] = useState(false);

            useEffect(() => { loadProducts(); }, []);

            const loadProducts = async () => {
                setLoading(true);
                if (GOOGLE_SHEET_URL === "PASTE_YOUR_GOOGLE_SHEET_URL_HERE" || !GOOGLE_SHEET_URL) {
                    setProducts(SAMPLE_PRODUCTS);
                    setUsingSheets(false);
                    setLoading(false);
                    return;
                }

                try {
                    const response = await fetch(GOOGLE_SHEET_URL);
                    const text = await response.text();
                    const data = JSON.parse(text.substr(47).slice(0, -2));
                    const rows = data.table.rows;

                    const loadedProducts = rows.slice(1).map((row, index) => {
                        const images = [
                            row.c[3]?.v,
                            row.c[4]?.v,
                            row.c[5]?.v,
                            row.c[6]?.v
                        ].filter(img => img && img.trim());

                        return {
                            id: index + 1,
                            name: row.c[0]?.v || "",
                            category: row.c[1]?.v || "Accessories",
                            price: parseFloat(row.c[2]?.v) || 0,
                            images: images.length > 0 ? images : ["https://via.placeholder.com/400"],
                            description: row.c[7]?.v || "",
                            discount: parseInt(row.c[8]?.v) || 0,
                            rating: parseFloat(row.c[9]?.v) || 4.5,
                            sold: parseInt(row.c[10]?.v) || 0,
                            inStock: (row.c[11]?.v || "yes").toLowerCase() === "yes"
                        };
                    }).filter(p => p.name);

                    setProducts(loadedProducts);
                    setUsingSheets(true);
                } catch (error) {
                    console.error("Could not load from Google Sheets:", error);
                    setProducts(SAMPLE_PRODUCTS);
                    setUsingSheets(false);
                }
                setLoading(false);
            };

            const filteredProducts = products.filter(product => {
                const matchesCategory = selectedCategory === "All" || product.category === selectedCategory;
                const matchesSearch = product.name.toLowerCase().includes(searchQuery.toLowerCase()) ||
                    product.description.toLowerCase().includes(searchQuery.toLowerCase());
                return matchesCategory && matchesSearch;
            });

            const addToCart = (product) => {
                const existing = cart.find(item => item.id === product.id);
                if (existing) {
                    setCart(cart.map(item => item.id === product.id ? { ...item, quantity: item.quantity + 1 } : item));
                } else {
                    setCart([...cart, { ...product, quantity: 1 }]);
                }
            };

            const removeFromCart = (productId) => setCart(cart.filter(item => item.id !== productId));
            const updateQuantity = (productId, quantity) => {
                if (quantity <= 0) removeFromCart(productId);
                else setCart(cart.map(item => item.id === productId ? { ...item, quantity } : item));
            };
            const calculateTotal = () => cart.reduce((sum, item) => {
                const discountedPrice = item.price * (1 - item.discount / 100);
                return sum + (discountedPrice * item.quantity);
            }, 0);
            const formatPrice = (usd) => `$${usd.toFixed(2)} (₦${Math.round(usd * NGN_TO_USD).toLocaleString()})`;
            const cartItemCount = cart.reduce((sum, item) => sum + item.quantity, 0);

            return (
                <div className="min-h-screen bg-gray-50">
                    <header className="gradient-bg text-white shadow-lg sticky top-0 z-50">
                        <div className="container mx-auto px-4 py-4">
                            <div className="flex items-center justify-between">
                                <div className="flex items-center space-x-3 cursor-pointer" onClick={() => setView("home")}>
                                    <i className="fas fa-bolt text-3xl"></i>
                                    <h1 className="text-2xl md:text-3xl font-bold">GadgetHub</h1>
                                </div>
                                <div className="flex items-center space-x-4">
                                    <a href="track-order.html" className="text-white hover:text-cyan-200 hidden md:block">
                                        <i className="fas fa-shipping-fast mr-1"></i> Track Order
                                    </a>
                                    <button className="relative" onClick={() => setView("cart")}>
                                        <i className="fas fa-shopping-cart text-2xl"></i>
                                        {cartItemCount > 0 && <span className="cart-badge">{cartItemCount}</span>}
                                    </button>
                                </div>
                            </div>
                            <div className="mt-4">
                                <div className="relative">
                                    <input type="text" placeholder="Search for products..." className="w-full px-4 py-3 rounded-full text-gray-800 focus:outline-none focus:ring-2 focus:ring-cyan-300" value={searchQuery} onChange={(e) => setSearchQuery(e.target.value)} />
                                    <i className="fas fa-search absolute right-4 top-4 text-gray-400"></i>
                                </div>
                            </div>
                        </div>
                    </header>

                    {view === "home" && <HomePage products={filteredProducts} categories={CATEGORIES} selectedCategory={selectedCategory} setSelectedCategory={setSelectedCategory} addToCart={addToCart} setView={setView} setSelectedProduct={setSelectedProduct} loading={loading} usingSheets={usingSheets} />}
                    {view === "product" && <ProductPage product={selectedProduct} addToCart={addToCart} setView={setView} />}
                    {view === "cart" && <CartPage cart={cart} updateQuantity={updateQuantity} removeFromCart={removeFromCart} calculateTotal={calculateTotal} formatPrice={formatPrice} setView={setView} />}
                    {view === "checkout" && <CheckoutPage cart={cart} calculateTotal={calculateTotal} formatPrice={formatPrice} setView={setView} setCart={setCart} />}

                    <footer className="bg-gray-900 text-white mt-8 py-8">
                        <div className="container mx-auto px-4">
                            <div className="text-center mb-6">
                                <i className="fas fa-bolt text-3xl text-cyan-400"></i>
                                <h3 className="text-xl font-bold mt-2">GadgetHub</h3>
                                <p className="text-gray-400 mt-1">Your Premium Electronics Store</p>
                            </div>
                            <div className="flex flex-wrap justify-center gap-4 md:gap-6 mb-6 text-sm">
                                <a href="track-order.html" className="text-cyan-400 hover:text-white transition font-semibold"><i className="fas fa-shipping-fast mr-1"></i>Track Order</a>
                                <a href="legal-pages.html#terms" className="text-gray-400 hover:text-cyan-400 transition">Terms</a>
                                <a href="legal-pages.html#privacy" className="text-gray-400 hover:text-cyan-400 transition">Privacy</a>
                                <a href="legal-pages.html#refund" className="text-gray-400 hover:text-cyan-400 transition">Refund</a>
                                <a href="legal-pages.html#shipping" className="text-gray-400 hover:text-cyan-400 transition">Shipping</a>
                                <a href="legal-pages.html#contact" className="text-gray-400 hover:text-cyan-400 transition">Contact</a>
                            </div>
                            <div className="text-center">
                                <p className="text-gray-500 text-sm">© 2025 GadgetHub. All rights reserved.</p>
                                <p className="text-gray-600 text-xs mt-2"><i className="fas fa-shield-alt mr-1"></i>Secure payments by Paystack & NOWPayments</p>
                            </div>
                        </div>
                    </footer>
                </div>
            );
        }

        function HomePage({ products, categories, selectedCategory, setSelectedCategory, addToCart, setView, setSelectedProduct, loading, usingSheets }) {
            return (
                <>
                    <div className="gradient-bg text-white py-12">
                        <div className="container mx-auto px-4 text-center">
                            <h2 className="text-4xl md:text-5xl font-bold mb-4">Premium Electronics Worldwide</h2>
                            <p className="text-xl opacity-90">Shop the latest gadgets • Secure payments • Global delivery</p>
                        </div>
                    </div>
                    {!usingSheets && !loading && (
                        <div className="bg-yellow-50 border-b border-yellow-200 py-3">
                            <div className="container mx-auto px-4 text-center">
                                <p className="text-yellow-700 text-sm"><i className="fas fa-info-circle mr-2"></i>Showing sample products. Connect Google Sheets to manage your products!</p>
                            </div>
                        </div>
                    )}
                    <div className="container mx-auto px-4 py-6">
                        <div className="flex overflow-x-auto space-x-3 pb-2">
                            {categories.map(cat => (
                                <button key={cat.name} className={`category-chip px-6 py-3 rounded-full whitespace-nowrap flex items-center space-x-2 ${selectedCategory === cat.name ? 'bg-blue-600 text-white' : 'bg-white text-gray-700 border'}`} onClick={() => setSelectedCategory(cat.name)}>
                                    <i className={`fas ${cat.icon}`}></i><span>{cat.name}</span>
                                </button>
                            ))}
                        </div>
                    </div>
                    <div className="container mx-auto px-4 pb-6">
                        <div className="bg-gradient-to-r from-red-500 to-pink-500 rounded-2xl p-6 text-white">
                            <div className="flex items-center justify-between">
                                <div>
                                    <h3 className="text-2xl font-bold flash-deal">⚡ Flash Deals</h3>
                                    <p className="opacity-90">Limited time offers!</p>
                                </div>
                                <div className="text-right">
                                    <p className="text-sm opacity-90">Ends in</p>
                                    <p className="text-3xl font-bold">23:59:42</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div className="container mx-auto px-4 pb-10">
                        <h3 className="text-2xl font-bold mb-6">{selectedCategory === "All" ? "All Products" : selectedCategory}</h3>
                        {loading ? (
                            <div className="flex flex-col items-center py-20">
                                <div className="spinner mb-4"></div>
                                <p className="text-gray-500">Loading products...</p>
                            </div>
                        ) : products.length === 0 ? (
                            <div className="text-center py-20">
                                <i className="fas fa-box-open text-6xl text-gray-300 mb-4"></i>
                                <p className="text-gray-500 text-xl">No products found</p>
                            </div>
                        ) : (
                            <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 md:gap-6">
                                {products.map(product => (
                                    <ProductCard key={product.id} product={product} addToCart={addToCart} setView={setView} setSelectedProduct={setSelectedProduct} />
                                ))}
                            </div>
                        )}
                    </div>
                </>
            );
        }

        function ProductCard({ product, addToCart, setView, setSelectedProduct }) {
            const discountedPrice = product.price * (1 - product.discount / 100);
            const mainImage = product.images && product.images.length > 0 ? product.images[0] : "https://via.placeholder.com/400";
            return (
                <div className="product-card bg-white rounded-xl overflow-hidden shadow-md relative">
                    {product.discount > 0 && <span className="badge">-{product.discount}%</span>}
                    {!product.inStock && <span className="badge" style={{background:'#6B7280'}}>Out of Stock</span>}
                    <div className="cursor-pointer" onClick={() => { setSelectedProduct(product); setView("product"); }}>
                        <img src={mainImage} alt={product.name} className="w-full h-48 object-cover" onError={(e) => { e.target.src = 'https://via.placeholder.com/400'; }} />
                        <div className="p-4">
                            <h4 className="font-semibold text-sm md:text-base mb-2 line-clamp-2">{product.name}</h4>
                            <div className="flex items-center space-x-1 mb-2">
                                <i className="fas fa-star text-yellow-400 text-xs"></i>
                                <span className="text-sm text-gray-600">{product.rating}</span>
                                <span className="text-xs text-gray-400">({product.sold} sold)</span>
                            </div>
                            <div className="mb-3">
                                {product.discount > 0 && <p className="text-xs text-gray-400 line-through">${product.price}</p>}
                                <p className="text-blue-600 font-bold">${discountedPrice.toFixed(2)}</p>
                                <p className="text-xs text-gray-500">₦{Math.round(discountedPrice * 1550).toLocaleString()}</p>
                            </div>
                        </div>
                    </div>
                    <div className="px-4 pb-4">
                        <button className={`btn-primary w-full text-white py-2 rounded-lg font-semibold text-sm ${!product.inStock ? 'opacity-50 cursor-not-allowed' : ''}`} onClick={() => product.inStock && addToCart(product)} disabled={!product.inStock}>
                            <i className="fas fa-cart-plus mr-2"></i>{product.inStock ? 'Add to Cart' : 'Out of Stock'}
                        </button>
                    </div>
                </div>
            );
        }

        function ProductPage({ product, addToCart, setView }) {
            const [selectedImageIndex, setSelectedImageIndex] = useState(0);
            if (!product) return null;
            const discountedPrice = product.price * (1 - product.discount / 100);
            const images = product.images || ["https://via.placeholder.com/400"];
            
            return (
                <div className="container mx-auto px-4 py-8">
                    <button className="mb-6 text-blue-600 flex items-center space-x-2" onClick={() => setView("home")}>
                        <i className="fas fa-arrow-left"></i><span>Back</span>
                    </button>
                    <div className="bg-white rounded-2xl shadow-lg overflow-hidden">
                        <div className="md:flex">
                            <div className="md:w-1/2 p-4">
                                <img src={images[selectedImageIndex]} alt={product.name} className="image-gallery-main mb-4" onError={(e) => { e.target.src = 'https://via.placeholder.com/400'; }} />
                                {images.length > 1 && (
                                    <div className="flex gap-2 overflow-x-auto">
                                        {images.map((img, idx) => (
                                            <img key={idx} src={img} alt={`${product.name} ${idx + 1}`} className={`thumbnail ${selectedImageIndex === idx ? 'active' : ''}`} onClick={() => setSelectedImageIndex(idx)} onError={(e) => { e.target.src = 'https://via.placeholder.com/80'; }} />
                                        ))}
                                    </div>
                                )}
                            </div>
                            <div className="md:w-1/2 p-8">
                                <span className="inline-block bg-blue-100 text-blue-600 px-4 py-1 rounded-full text-sm mb-4">{product.category}</span>
                                <h1 className="text-3xl font-bold mb-4">{product.name}</h1>
                                <div className="flex items-center space-x-2 mb-4">
                                    {[...Array(5)].map((_, i) => <i key={i} className={`fas fa-star ${i < Math.floor(product.rating) ? 'text-yellow-400' : 'text-gray-300'}`}></i>)}
                                    <span>({product.rating})</span>
                                    <span className="text-gray-400">• {product.sold} sold</span>
                                </div>
                                <p className="text-gray-600 mb-6">{product.description}</p>
                                <div className="mb-6">
                                    {product.discount > 0 && (
                                        <div className="flex items-center space-x-3">
                                            <p className="text-gray-400 line-through text-lg">${product.price.toFixed(2)}</p>
                                            <span className="bg-red-500 text-white px-3 py-1 rounded-full text-sm font-bold">-{product.discount}%</span>
                                        </div>
                                    )}
                                    <p className="text-4xl font-bold text-blue-600">${discountedPrice.toFixed(2)}</p>
                                    <p className="text-gray-500 mt-1">≈ ₦{Math.round(discountedPrice * 1550).toLocaleString()}</p>
                                </div>
                                <p className="text-sm mb-6">Status: <span className={`font-semibold ${product.inStock ? 'text-green-600' : 'text-red-600'}`}>{product.inStock ? '✅ In Stock' : '❌ Out of Stock'}</span></p>
                                <button className={`btn-primary w-full text-white py-4 rounded-xl font-bold text-lg ${!product.inStock ? 'opacity-50 cursor-not-allowed' : ''}`} onClick={() => { if (product.inStock) { addToCart(product); setView("cart"); } }} disabled={!product.inStock}>
                                    <i className="fas fa-cart-plus mr-2"></i>{product.inStock ? 'Add to Cart' : 'Out of Stock'}
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        function CartPage({ cart, updateQuantity, removeFromCart, calculateTotal, formatPrice, setView }) {
            if (cart.length === 0) return (
                <div className="container mx-auto px-4 py-16 text-center">
                    <i className="fas fa-shopping-cart text-6xl text-gray-300 mb-4"></i>
                    <h2 className="text-2xl font-bold text-gray-600 mb-4">Your cart is empty</h2>
                    <button className="btn-primary text-white px-8 py-3 rounded-lg font-semibold" onClick={() => setView("home")}>Start Shopping</button>
                </div>
            );
            return (
                <div className="container mx-auto px-4 py-8">
                    <h2 className="text-3xl font-bold mb-6">Shopping Cart ({cart.length})</h2>
                    <div className="grid md:grid-cols-3 gap-6">
                        <div className="md:col-span-2">
                            {cart.map(item => {
                                const discountedPrice = item.price * (1 - item.discount / 100);
                                const mainImage = item.images && item.images.length > 0 ? item.images[0] : "https://via.placeholder.com/100";
                                return (
                                    <div key={item.id} className="bg-white rounded-xl shadow-md p-4 mb-4">
                                        <div className="flex">
                                            <img src={mainImage} alt={item.name} className="w-24 h-24 object-cover rounded-lg" />
                                            <div className="flex-1 ml-4">
                                                <h3 className="font-semibold mb-2">{item.name}</h3>
                                                <p className="text-blue-600 font-bold mb-2">${discountedPrice.toFixed(2)} <span className="text-sm text-gray-500">(₦{Math.round(discountedPrice * 1550).toLocaleString()})</span></p>
                                                <div className="flex items-center space-x-4">
                                                    <div className="flex items-center space-x-2">
                                                        <button className="bg-gray-200 px-3 py-1 rounded" onClick={() => updateQuantity(item.id, item.quantity - 1)}>-</button>
                                                        <span className="px-4">{item.quantity}</span>
                                                        <button className="bg-gray-200 px-3 py-1 rounded" onClick={() => updateQuantity(item.id, item.quantity + 1)}>+</button>
                                                    </div>
                                                    <button className="text-red-500" onClick={() => removeFromCart(item.id)}><i className="fas fa-trash"></i> Remove</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                        <div>
                            <div className="bg-white rounded-xl shadow-md p-6 sticky top-24">
                                <h3 className="text-xl font-bold mb-4">Order Summary</h3>
                                <div className="space-y-3 mb-4">
                                    <div className="flex justify-between"><span className="text-gray-600">Subtotal:</span><span className="font-semibold">{formatPrice(calculateTotal())}</span></div>
                                    <div className="flex justify-between"><span className="text-gray-600">Shipping:</span><span className="font-semibold text-green-600">FREE</span></div>
                                    <div className="border-t pt-3 flex justify-between"><span className="font-bold">Total:</span><span className="font-bold text-xl text-blue-600">{formatPrice(calculateTotal())}</span></div>
                                </div>
                                <button className="btn-primary w-full text-white py-3 rounded-lg font-bold" onClick={() => setView("checkout")}>Proceed to Checkout</button>
                                <button className="w-full text-blue-600 py-3 rounded-lg font-semibold mt-2" onClick={() => setView("home")}>Continue Shopping</button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        function CheckoutPage({ cart, calculateTotal, formatPrice, setView, setCart }) {
            const [paymentMethod, setPaymentMethod] = useState("paystack");
            const [email, setEmail] = useState("");
            const [name, setName] = useState("");
            const [phone, setPhone] = useState("");
            const [address, setAddress] = useState("");
            const [processing, setProcessing] = useState(false);
            const totalUSD = calculateTotal();
            const totalNGN = Math.round(totalUSD * 1550 * 100);

            const handlePaystackPayment = () => {
                if (!email || !name || !phone || !address) { alert("Please fill in all required fields"); return; }
                setProcessing(true);
                const handler = PaystackPop.setup({
                    key: PAYSTACK_PUBLIC_KEY,
                    email, amount: totalNGN, currency: 'NGN',
                    ref: 'GH-' + Math.floor((Math.random() * 1000000000) + 1),
                    metadata: { custom_fields: [{ display_name: "Customer Name", variable_name: "customer_name", value: name }, { display_name: "Phone", variable_name: "phone", value: phone }] },
                    callback: function(response) {
                        setProcessing(false);
                        alert('✅ Payment successful! Reference: ' + response.reference + '\n\nThank you!');
                        setCart([]);
                        setView("home");
                    },
                    onClose: function() { setProcessing(false); }
                });
                handler.openIframe();
            };

            const handleCryptoPayment = async () => {
                if (!email || !name) { alert("Please fill in your email and name"); return; }
                setProcessing(true);
                try {
                    const response = await fetch('https://api.nowpayments.io/v1/invoice', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json', 'x-api-key': NOWPAYMENTS_API_KEY },
                        body: JSON.stringify({ price_amount: totalUSD, price_currency: 'usd', order_id: 'GH-' + Math.floor((Math.random() * 1000000000) + 1), order_description: 'GadgetHub Purchase', success_url: window.location.href, cancel_url: window.location.href })
                    });
                    const data = await response.json();
                    if (data.invoice_url) { window.location.href = data.invoice_url; } else { throw new Error('Failed'); }
                } catch (error) {
                    setProcessing(false);
                    alert('Payment failed. Please try again.');
                }
            };

            return (
                <div className="container mx-auto px-4 py-8">
                    <button className="mb-6 text-blue-600 flex items-center space-x-2" onClick={() => setView("cart")}><i className="fas fa-arrow-left"></i><span>Back</span></button>
                    <h2 className="text-3xl font-bold mb-6">Checkout</h2>
                    <div className="grid md:grid-cols-3 gap-6">
                        <div className="md:col-span-2">
                            <div className="bg-white rounded-xl shadow-md p-6 mb-6">
                                <h3 className="text-xl font-bold mb-4">Customer Information</h3>
                                <div className="space-y-4">
                                    <div><label className="block text-gray-700 mb-2">Full Name *</label><input type="text" className="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" value={name} onChange={(e) => setName(e.target.value)} placeholder="Your name" /></div>
                                    <div><label className="block text-gray-700 mb-2">Email *</label><input type="email" className="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" value={email} onChange={(e) => setEmail(e.target.value)} placeholder="your@email.com" /></div>
                                    <div><label className="block text-gray-700 mb-2">Phone *</label><input type="tel" className="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" value={phone} onChange={(e) => setPhone(e.target.value)} placeholder="+1234567890" /></div>
                                    <div><label className="block text-gray-700 mb-2">Address *</label><textarea className="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" value={address} onChange={(e) => setAddress(e.target.value)} placeholder="Full delivery address" rows="3"></textarea></div>
                                </div>
                            </div>
                            <div className="bg-white rounded-xl shadow-md p-6">
                                <h3 className="text-xl font-bold mb-4">Payment Method</h3>
                                <div className="space-y-3">
                                    <div className={`border-2 rounded-lg p-4 cursor-pointer ${paymentMethod === "paystack" ? 'border-blue-600 bg-blue-50' : 'border-gray-300'}`} onClick={() => setPaymentMethod("paystack")}>
                                        <div className="flex items-center justify-between">
                                            <div className="flex items-center space-x-3"><i className="fas fa-credit-card text-2xl text-blue-600"></i><div><h4 className="font-semibold">Card / Bank Transfer / USSD</h4><p className="text-sm text-gray-600">Paystack</p></div></div>
                                            {paymentMethod === "paystack" && <i className="fas fa-check-circle text-blue-600 text-xl"></i>}
                                        </div>
                                    </div>
                                    <div className={`border-2 rounded-lg p-4 cursor-pointer ${paymentMethod === "crypto" ? 'border-blue-600 bg-blue-50' : 'border-gray-300'}`} onClick={() => setPaymentMethod("crypto")}>
                                        <div className="flex items-center justify-between">
                                            <div className="flex items-center space-x-3"><i className="fab fa-bitcoin text-2xl text-orange-500"></i><div><h4 className="font-semibold">Cryptocurrency</h4><p className="text-sm text-gray-600">BTC, ETH, USDT</p></div></div>
                                            {paymentMethod === "crypto" && <i className="fas fa-check-circle text-blue-600 text-xl"></i>}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div>
                            <div className="bg-white rounded-xl shadow-md p-6 sticky top-24">
                                <h3 className="text-xl font-bold mb-4">Order Summary</h3>
                                <div className="space-y-2 mb-4 max-h-48 overflow-y-auto">
                                    {cart.map(item => {
                                        const dp = item.price * (1 - item.discount / 100);
                                        return <div key={item.id} className="flex justify-between text-sm"><span className="text-gray-600">{item.name} x{item.quantity}</span><span>${(dp * item.quantity).toFixed(2)}</span></div>;
                                    })}
                                </div>
                                <div className="border-t pt-4 space-y-3">
                                    <div className="flex justify-between"><span className="text-gray-600">Subtotal:</span><span>${totalUSD.toFixed(2)}</span></div>
                                    <div className="flex justify-between"><span className="text-gray-600">Shipping:</span><span className="text-green-600">FREE</span></div>
                                    <div className="border-t pt-3 flex justify-between"><span className="font-bold">Total:</span><div className="text-right"><div className="font-bold text-xl text-blue-600">${totalUSD.toFixed(2)}</div><div className="text-sm text-gray-500">≈ ₦{Math.round(totalUSD * 1550).toLocaleString()}</div></div></div>
                                </div>
                                <button className={`btn-primary w-full text-white py-4 rounded-lg font-bold mt-6 ${processing ? 'opacity-50 cursor-not-allowed' : ''}`} onClick={() => paymentMethod === "paystack" ? handlePaystackPayment() : handleCryptoPayment()} disabled={processing}>
                                    {processing ? <><i className="fas fa-spinner fa-spin mr-2"></i>Processing...</> : <><i className="fas fa-lock mr-2"></i>Complete Payment</>}
                                </button>
                                <p className="text-xs text-gray-500 text-center mt-4"><i className="fas fa-shield-alt mr-1"></i>Secure payment</p>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<GadgetHub />, document.getElementById('root'));
    </script>
</body>
</html>